/**
 * Materialize Stepper - A little plugin that implements a stepper to Materializecss framework.
 * @version v3.0.0
 * @author Igor Marcossi (Kinark) <igormarcossi@gmail.com>.
 * @link https://github.com/Kinark/Materialize-stepper
 * 
 * Licensed under the MIT License (https://github.com/Kinark/Materialize-stepper/blob/master/LICENSE).
 */

"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var MStepper=function(){function E(e){var P=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,E),_defineProperty(this,"smartListenerUnbind",function(e,t,n){var i=P.listenerStore,s=i.indexOf({el:e,event:t,fn:n});e.removeEventListener(t,n),i.splice(s,1)}),_defineProperty(this,"smartListenerBind",function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],s=4<arguments.length&&void 0!==arguments[4]&&arguments[4],r=P.listenerStore,a={el:e,event:t,fn:n};if(i)for(var o=0;o<r.length;o++){var l=r[o];l.event===t&&l.el.isSameNode(e)&&l.el.removeEventListener(l.event,l.fn),s&&l.fn()}else{var p=r.indexOf(a);if(-1!==c){var c=r[p];c.el.removeEventListener(c.event,c.fn),s&&c[p].fn()}}e.addEventListener(t,n),r.push(a)}),_defineProperty(this,"_slideDown",function(n,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,i="".concat(E.getUnknownHeight(n),"px"),s=function e(t){"height"===t.propertyName&&(P.smartListenerUnbind(n,"transitionend",e),E.removeMultipleProperties(n,"visibility overflow height display"))};return requestAnimationFrame(function(){n.style.overflow="hidden",n.style.visibility="unset",n.style.display="block",n.style.height="0",requestAnimationFrame(function(){P.smartListenerBind(n,"transitionend",s,!0),n.style.height=i,e&&t.classList.add(e)})}),n}),_defineProperty(this,"_slideUp",function(n,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,i="".concat(n.offsetHeight,"px"),s=function e(t){"height"===t.propertyName&&(P.smartListenerUnbind(n,"transitionend",e),E.removeMultipleProperties(n,"visibility overflow height display"))};return requestAnimationFrame(function(){n.style.overflow="hidden",n.style.visibility="unset",n.style.display="block",n.style.height=i,requestAnimationFrame(function(){P.smartListenerBind(n,"transitionend",s,!0),n.style.height="0",e&&t.classList.remove(e)})}),n}),_defineProperty(this,"_closeAction",function(e){var t=P._slideUp,n=P.classes;return t(e.getElementsByClassName(n.STEPCONTENT)[0],n.ACTIVESTEP,e),e}),_defineProperty(this,"_openAction",function(e){var t=P._slideDown,n=P.classes;return t(e.getElementsByClassName(n.STEPCONTENT)[0],n.ACTIVESTEP,e),e}),_defineProperty(this,"_init",function(){var e=P._formWrapperManager,t=P.getSteps,n=P.options,i=P.stepper,s=P.classes,r=P.nextStep,a=P.prevStep,o=P._stepTitleClickHandler,l=P._openAction,p=E.addMultipleEventListeners;P.form=e(),l(t().steps[n.firstActive]);var c=i.getElementsByClassName(s.NEXTSTEPBTN),d=i.getElementsByClassName(s.PREVSTEPBTN),v=i.getElementsByClassName(s.STEPTITLE);p(c,"click",r,!1),p(d,"click",a,!1),p(v,"click",o)}),_defineProperty(this,"nextStep",function(e,t){e&&e.preventDefault&&e.preventDefault();var n=P.options,i=P.getSteps,s=P.activateFeedback,r=P.form,a=P.wrongStep,o=P.classes,l=P._closeAction,p=P._openAction,c=P.stepper,d=P.events,v=n.showFeedbackPreloader,E=n.validationFunction,f=i().active,u=i().steps[f.index+1],h=u.querySelector("input, select");return f.step.dataset.feedback&&!t?(v&&!f.step.dataset.nopreloader&&s(),void window[f.step.dataset.feedback](r,f.step)):E&&!E(r,f.step)?a():(f.step.classList.add(o.DONESTEP),l(f.step),p(u),n.autoFocusInput&&h&&h.focus(),c.dispatchEvent(d.STEPCHANGE),void c.dispatchEvent(d.NEXTSTEP))}),_defineProperty(this,"prevStep",function(e){e&&e.preventDefault&&e.preventDefault();var t=P.getSteps,n=P.classes,i=P._closeAction,s=P._openAction,r=P.stepper,a=P.events,o=t().active,l=t().steps[o.index+-1];l.classList.remove(n.DONESTEP),i(o.step),s(l),r.dispatchEvent(a.STEPCHANGE),r.dispatchEvent(a.PREVSTEP)}),_defineProperty(this,"_stepTitleClickHandler",function(e){var t=P.getSteps,n=P.classes,i=P.nextStep,s=P.prevStep,r=t(),a=r.steps,o=r.active,l=E.parents(e.target,".".concat(n.STEP)),p=Array.prototype.indexOf.call(a,l);p==o.index+1?i():p==o.index-1&&s()}),_defineProperty(this,"activateFeedback",function(){var e=P.getSteps,t=P.classes,n=P.options,i=P.stepper,s=P.events,r=e().active.step;r.classList.add(t.FEEDBACKINGSTEP),r.getElementsByClassName(t.STEPCONTENT)[0].insertAdjacentHTML("afterBegin",'<div class="'.concat(t.PRELOADERWRAPPER,'">').concat(n.feedbackPreloader,"</div>")),i.dispatchEvent(s.FEEDBACKING)}),_defineProperty(this,"destroyFeedback",function(e){var t=P.getSteps,n=P.classes,i=P.nextStep,s=P.stepper,r=P.events,a=t().active.step;a.classList.remove(n.FEEDBACKINGSTEP);var o=a.getElementsByClassName(n.PRELOADERWRAPPER)[0];o.parentNode.removeChild(o),e&&i(void 0,!0),s.dispatchEvent(r.FEEDBACKDESTROYED)}),_defineProperty(this,"wrongStep",function(){var t=P.getSteps,n=P.classes,e=P.stepper,i=P.events;t().active.step.classList.add(n.WRONGSTEP);var s=t().active.step.querySelectorAll("input, select");E.addMultipleEventListeners(s,"input",function e(){t().active.step.classList.remove(n.WRONGSTEP),E.removeMultipleEventListeners(s,"input",e)}),e.dispatchEvent(i.STEPERROR)}),_defineProperty(this,"getSteps",function(){var e=P.stepper,t=P.classes,n=e.querySelectorAll("li.".concat(t.STEP)),i=e.querySelector("li.".concat(t.ACTIVESTEP));return{steps:n,active:{step:i,index:Array.prototype.indexOf.call(n,i)}}}),_defineProperty(this,"activateStep",function(e){(0,P._slideDown)(e)}),_defineProperty(this,"deactivateStep",function(e){(0,P._slideUp)(e)}),_defineProperty(this,"_formWrapperManager",function(){var e=P.stepper,t=P.options,n=E.parents(e,"form");if(n.length||!t.autoFormCreation)return n.length?n:null;var i=e.dataset||{},s=i.method||"GET",r=i.action||"?",a=document.createElement("form");return a.method=s,a.action=r,e.parentNode.insertBefore(a,e),a.appendChild(e),a}),this.stepper=e,this.options={firstActive:t.firstActive||0,linearStepsNavigation:t.linearStepsNavigation||!0,autoFocusInput:t.autoFocusInput||!0,showFeedbackPreloader:t.showFeedbackPreloader||!0,autoFormCreation:t.autoFormCreation||!0,validationFunction:t.validationFunction||null,feedbackPreloader:t.feedbackPreloader||'<div class="preloader-wrapper active"> <div class="spinner-layer spinner-blue-only"> <div class="circle-clipper left"> <div class="circle"></div></div><div class="gap-patch"> <div class="circle"></div></div><div class="circle-clipper right"> <div class="circle"></div></div></div></div>'},this.classes={NEXTSTEPBTN:"next-step",PREVSTEPBTN:"previous-step",STEPTITLE:"step-title",STEP:"step",STEPCONTENT:"step-content",PRELOADERWRAPPER:"wait-feedback",FEEDBACKINGSTEP:"feedbacking",ACTIVESTEP:"active",WRONGSTEP:"wrong",DONESTEP:"done"},this.events={STEPCHANGE:new Event("stepchange"),NEXTSTEP:new Event("nextstep"),PREVSTEP:new Event("prevstep"),STEPERROR:new Event("steperror"),FEEDBACKING:new Event("feedbacking"),FEEDBACKDESTROYED:new Event("feedbackdestroyed")},this.listenerStore=[],this.form=null,this._init()}return _createClass(E,null,[{key:"addMultipleEventListeners",value:function(e,t,n){for(var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],s=0,r=e.length;s<r;s++)e[s].addEventListener(t,n,i)}},{key:"removeMultipleEventListeners",value:function(e,t,n){for(var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],s=0,r=e.length;s<r;s++)e[s].removeEventListener(t,n,i)}},{key:"parents",value:function(e,t){for(var n=[],i=void 0!==t;null!==(e=e.parentElement);)e.nodeType===Node.ELEMENT_NODE&&(i&&!e.matches(t)||n.push(e));return n[0]||!1}},{key:"removeMultipleProperties",value:function(e,t){for(var n=t.split(" "),i=0;i<n.length;i++)e.style.removeProperty(n[i])}},{key:"getUnknownHeight",value:function(e){var t=e.cloneNode(!0);t.style.position="fixed",t.style.display="block",t.style.top="-999999px",t.style.left="-999999px",t.style.height="auto",t.style.opacity="0",t.style.zIndex="-999999",t.style.pointerEvents="none";var n=e.parentNode.appendChild(t),i=n.offsetHeight;return e.parentNode.removeChild(n),i}}]),E}();