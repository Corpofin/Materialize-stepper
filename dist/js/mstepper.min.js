/**
 * Materialize Stepper - A little plugin that implements a stepper to Materializecss framework.
 * @version v3.0.0
 * @author Igor Marcossi (Kinark) <igormarcossi@gmail.com>.
 * @link https://github.com/Kinark/Materialize-stepper
 * 
 * Licensed under the MIT License (https://github.com/Kinark/Materialize-stepper/blob/master/LICENSE).
 */

"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var MStepper=function(){function E(e){var h=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,E),_defineProperty(this,"smartListenerUnbind",function(e,t,n){var i=h.listenerStore,s=i.indexOf({el:e,event:t,fn:n});e.removeEventListener(t,n),i.splice(s,1)}),_defineProperty(this,"smartListenerBind",function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],s=4<arguments.length&&void 0!==arguments[4]&&arguments[4],r=h.listenerStore,a={el:e,event:t,fn:n};if(i)for(var o=0;o<r.length;o++){var l=r[o];l.event===t&&l.el.isSameNode(e)&&l.el.removeEventListener(l.event,l.fn),s&&l.fn()}else{var c=r.indexOf(a);if(-1!==p){var p=r[c];p.el.removeEventListener(p.event,p.fn),s&&p[c].fn()}}e.addEventListener(t,n),r.push(a)}),_defineProperty(this,"_slideDown",function(n,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,i=3<arguments.length?arguments[3]:void 0,s="".concat(E.getUnknownHeight(n),"px"),r=function e(t){"height"===t.propertyName&&(h.smartListenerUnbind(n,"transitionend",e),E.removeMultipleProperties(n,"visibility overflow height display"),i&&i())};return requestAnimationFrame(function(){n.style.overflow="hidden",n.style.paddingBottom="0",n.style.height="0",n.style.visibility="unset",n.style.display="block",requestAnimationFrame(function(){h.smartListenerBind(n,"transitionend",r,!0),n.style.height=s,n.style.removeProperty("padding-bottom"),e&&t.classList.add(e)})}),n}),_defineProperty(this,"_slideUp",function(n,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,i=3<arguments.length?arguments[3]:void 0,s="".concat(n.offsetHeight,"px"),r=function e(t){"height"===t.propertyName&&(h.smartListenerUnbind(n,"transitionend",e),n.style.display="none",E.removeMultipleProperties(n,"visibility overflow height padding-bottom"),i&&i())};return requestAnimationFrame(function(){n.style.overflow="hidden",n.style.visibility="unset",n.style.display="block",n.style.height=s,requestAnimationFrame(function(){h.smartListenerBind(n,"transitionend",r,!0),n.style.height="0",n.style.paddingBottom="0",e&&t.classList.remove(e)})}),n}),_defineProperty(this,"_closeAction",function(e){var t=h._slideUp,n=h.classes,i=h.stepper,s=e.getElementsByClassName(n.STEPCONTENT)[0];return window.innerWidth<993||!i.classList.contains(n.HORIZONTALSTEPPER)?t(s,n.ACTIVESTEP,e):e.classList.remove("active"),e}),_defineProperty(this,"_openAction",function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=h._slideDown,i=h.classes,s=h.getSteps,r=h._closeAction,a=h.stepper,o=s().active.step;if(o&&o.isSameNode(e))return e;var l=e.getElementsByClassName(i.STEPCONTENT)[0];return e.classList.remove(i.DONESTEP),window.innerWidth<993||!a.classList.contains(i.HORIZONTALSTEPPER)?(o&&t&&r(o),n(l,i.ACTIVESTEP,e)):(e.classList.add("active"),o&&t&&r(o)),e}),_defineProperty(this,"_init",function(){var e=h._formWrapperManager,t=h.getSteps,n=h.options,i=h.stepper,s=h.classes,r=h.nextStep,a=h.prevStep,o=h._stepTitleClickHandler,l=h._openAction,c=E.addMultipleEventListeners;h.form=e(),l(t().steps[n.firstActive]);var p=i.getElementsByClassName(s.NEXTSTEPBTN),d=i.getElementsByClassName(s.PREVSTEPBTN),v=i.getElementsByClassName(s.STEPTITLE);c(p,"click",r,!1),c(d,"click",a,!1),c(v,"click",o)}),_defineProperty(this,"nextStep",function(e,t){e&&e.preventDefault&&e.preventDefault();var n=h.options,i=h.getSteps,s=h.activateFeedback,r=h.form,a=h.wrongStep,o=h.classes,l=h._openAction,c=h.stepper,p=h.events,d=n.showFeedbackPreloader,v=n.validationFunction,E=i().active,f=i().steps[E.index+1],u=e&&e.target?e.target.dataset.feedback:null;return u&&!t?(d&&!E.step.dataset.nopreloader&&s(),void window[u](r,E.step)):v&&!v(r,E.step)?a():(E.step.classList.add(o.DONESTEP),l(f),c.dispatchEvent(p.STEPCHANGE),void c.dispatchEvent(p.NEXTSTEP))}),_defineProperty(this,"prevStep",function(e){e&&e.preventDefault&&e.preventDefault();var t=h.getSteps,n=(h.classes,h._openAction),i=h.stepper,s=h.events,r=t().active;n(t().steps[r.index+-1]),i.dispatchEvent(s.STEPCHANGE),i.dispatchEvent(s.PREVSTEP)}),_defineProperty(this,"_stepTitleClickHandler",function(e){var t=h.getSteps,n=h.classes,i=h.nextStep,s=h.prevStep,r=h.stepper,a=h._openAction,o=t(),l=o.steps,c=o.active,p=E.parents(e.target,".".concat(n.STEP));if(r.classList.contains(n.LINEAR)){var d=Array.prototype.indexOf.call(l,p);d==c.index+1?i():d==c.index-1&&s()}else a(p)}),_defineProperty(this,"activateFeedback",function(){var e=h.getSteps,t=h.classes,n=h.options,i=h.stepper,s=h.events,r=e().active.step;r.classList.add(t.FEEDBACKINGSTEP),r.getElementsByClassName(t.STEPCONTENT)[0].insertAdjacentHTML("afterBegin",'<div class="'.concat(t.PRELOADERWRAPPER,'">').concat(n.feedbackPreloader,"</div>")),i.dispatchEvent(s.FEEDBACKING)}),_defineProperty(this,"destroyFeedback",function(e){var t=h.getSteps,n=h.classes,i=h.nextStep,s=h.stepper,r=h.events,a=t().active.step;a.classList.remove(n.FEEDBACKINGSTEP);var o=a.getElementsByClassName(n.PRELOADERWRAPPER)[0];o.parentNode.removeChild(o),e&&i(void 0,!0),s.dispatchEvent(r.FEEDBACKDESTROYED)}),_defineProperty(this,"wrongStep",function(){var t=h.getSteps,n=h.classes,e=h.stepper,i=h.events;t().active.step.classList.add(n.WRONGSTEP);var s=t().active.step.querySelectorAll("input, select");E.addMultipleEventListeners(s,"input",function e(){t().active.step.classList.remove(n.WRONGSTEP),E.removeMultipleEventListeners(s,"input",e)}),e.dispatchEvent(i.STEPERROR)}),_defineProperty(this,"getSteps",function(){var e=h.stepper,t=h.classes,n=e.querySelectorAll("li.".concat(t.STEP)),i=e.querySelector("li.".concat(t.ACTIVESTEP));return{steps:n,active:{step:i,index:Array.prototype.indexOf.call(n,i)}}}),_defineProperty(this,"activateStep",function(e,t){var n=h.getSteps,i=h._slideDown,s=h.stepper,r=n().steps[t],a=null;return"string"==typeof e?(r.insertAdjacentHTML("beforeBegin",e),a=r.previousSibling,i(a)):Array.isArray(e)?(a=[],e.forEach(function(e){r.insertAdjacentHTML("beforeBegin",e),a.push(r.previousSibling),i(r.previousSibling)})):(e instanceof Element||e instanceof HTMLCollection)&&(a=s.insertBefore(e,r),e instanceof Element?i(a):a.forEach(function(e){return i(e)})),a}),_defineProperty(this,"deactivateStep",function(t){var n=h._slideUp,i=h.stepper,s=function(e){i.contains(t)&&n(e,void 0,void 0,function(){return i.removeChild(e)})};return t instanceof Element?s(t):t instanceof HTMLCollection&&t.forEach(function(e){return s(e)}),t}),_defineProperty(this,"_formWrapperManager",function(){var e=h.stepper,t=h.options,n=E.parents(e,"form");if(n.length||!t.autoFormCreation)return n.length?n:null;var i=e.dataset||{},s=i.method||"GET",r=i.action||"?",a=document.createElement("form");return a.method=s,a.action=r,e.parentNode.insertBefore(a,e),a.appendChild(e),a}),this.stepper=e,this.options={firstActive:t.firstActive||0,linearStepsNavigation:t.linearStepsNavigation||!0,autoFocusInput:t.autoFocusInput||!0,showFeedbackPreloader:t.showFeedbackPreloader||!0,autoFormCreation:t.autoFormCreation||!0,validationFunction:t.validationFunction||null,feedbackPreloader:t.feedbackPreloader||'<div class="preloader-wrapper active"> <div class="spinner-layer spinner-blue-only"> <div class="circle-clipper left"> <div class="circle"></div></div><div class="gap-patch"> <div class="circle"></div></div><div class="circle-clipper right"> <div class="circle"></div></div></div></div>'},this.classes={HORIZONTALSTEPPER:"horizontal",LINEAR:"linear",NEXTSTEPBTN:"next-step",PREVSTEPBTN:"previous-step",STEPTITLE:"step-title",STEP:"step",STEPCONTENT:"step-content",PRELOADERWRAPPER:"wait-feedback",FEEDBACKINGSTEP:"feedbacking",ACTIVESTEP:"active",WRONGSTEP:"wrong",DONESTEP:"done"},this.events={STEPCHANGE:new Event("stepchange"),NEXTSTEP:new Event("nextstep"),PREVSTEP:new Event("prevstep"),STEPERROR:new Event("steperror"),FEEDBACKING:new Event("feedbacking"),FEEDBACKDESTROYED:new Event("feedbackdestroyed")},this.listenerStore=[],this.form=null,this._init()}return _createClass(E,null,[{key:"addMultipleEventListeners",value:function(e,t,n){for(var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],s=0,r=e.length;s<r;s++)e[s].addEventListener(t,n,i)}},{key:"removeMultipleEventListeners",value:function(e,t,n){for(var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],s=0,r=e.length;s<r;s++)e[s].removeEventListener(t,n,i)}},{key:"parents",value:function(e,t){for(var n=[],i=void 0!==t;null!==(e=e.parentElement);)e.nodeType===Node.ELEMENT_NODE&&(i&&!e.matches(t)||n.push(e));return n[0]||!1}},{key:"removeMultipleProperties",value:function(e,t){for(var n=t.split(" "),i=0;i<n.length;i++)e.style.removeProperty(n[i])}},{key:"getUnknownHeight",value:function(e){var t=e.cloneNode(!0);t.style.position="fixed",t.style.display="block",t.style.top="-999999px",t.style.left="-999999px",t.style.height="auto",t.style.opacity="0",t.style.zIndex="-999999",t.style.pointerEvents="none";var n=e.parentNode.insertBefore(t,e),i=n.offsetHeight;return e.parentNode.removeChild(n),i}}]),E}();